# コーディングガイドライン

## 基本方針

- .NETの最新機能を積極的に使用する
- 古いバージョンとの互換性が必要な場合を除き、常に最新機能を優先する
- 古い言語構文は避ける
- Microsoftの公式コーディング規約に従う
- 一貫性を保ち、全体で同じスタイルを適用する

## 命名規則

### アンダースコア接頭辞の禁止

- **すべての命名においてアンダースコア接頭辞（`_`）は禁止**
- **例外なく徹底する**

### 一般的な命名ルール

- 一般的でない略語は使用しない
- Boolean型は `is`、`has`、`can`、`should` を先頭に付ける
- 定数は UPPER_SNAKE_CASE
- クラス、メソッド、プロパティ、定数は PascalCase
- ローカル変数、パラメータ、プライベートフィールドは camelCase
- インターフェースは `I` + PascalCase

## コード設計

- シンプルで保守しやすいコードを書く
- 関数は単一責任とする
- 1つの関数は100行以内を目安とする
- ネストは原則として最大3段階まで
- ガード節を使用し、早期リターンを徹底する
- マジックナンバーを避け、定数を使用する
- **中括弧 `{}` は省略しない（1行のステートメントでも必ず使用）**
- 短い処理は1行で書く（短い条件・処理は中括弧つきで1行にまとめる）

```C#
public void ProcessOrder(Order order)
{
    if (order != null)
    {
        order.Process();
    }
}

// 1行でも中括弧を使用する
if (isValid) { Execute(); }
```

## コメントとドキュメンテーション

### 単一行コメント

- 「何を」ではなく「なぜ」を記述する
- TODO/FIXMEコメントは禁止 → Issueに登録する
- コメント区切り文字の後にスペースを1つ入れる
- コメントの前には空行を1行入れる
- **コメントは必ず単独の行に記述する（コードと同じ行には記述しない）**

### XMLドキュメント

- パブリックメンバーにはXMLドキュメントをつける
- プライベートメソッドにもXMLドキュメントを付ける

## 例外処理

**適切なエラーハンドリングを実施する:**

- 例外は例外的状況のみに使用する
- 例外を握りつぶさない
- 標準例外で不十分な場合はカスタム例外を作成する
- 例外クラス名は `Exception` で終わらせる
- エラー時には十分な情報をログ出力する

## パフォーマンス

**適切なタイミングで最適化する:**

- 早すぎる最適化を避ける
- `using` によりリソース破棄を徹底する
- I/O操作は非同期で実施する

## C#スタイル

- Nullable Reference Typesを有効化する
- 型が明確な場合は `var` を使用する
- 単純な処理には式形式メンバー（`=>`）を使用する
- 文字列補間 `$"..."` を使用する
- コレクション処理はLINQを活用する
- リソース管理にはusingステートメントまたは宣言を使用
- 不変データにはrecord型を使用する
- `async void` はイベントハンドラ以外では使用しない
- 非同期メソッドは `Task` または `ValueTask` を返す

## パフォーマンス最適化

**必要に応じて高度な最適化を適用する:**

- 頻繁なメモリ操作には `Span<T>` や `Memory<T>` を検討する
- 同期的に終わることが多い非同期処理には `ValueTask` を検討する
- ループ内の文字列連結には `StringBuilder` を使用する

## 属性とアノテーション

**適切な属性を使用する:**

- 廃止予定コードには `[Obsolete]` を付与し、代替を提示する
- 必要に応じて適切な属性を使用する

## 最新機能活用

### データモデリング

- レコード型（C# 9.0） - イミュータブルデータオブジェクト
- initアクセサ（C# 9.0） - オブジェクト初期化専用セッター
- required修飾子（C# 11.0） - 必須プロパティの強制
- プライマリコンストラクタ（C# 12.0） - クラス定義の簡略化

### 型システム

- ファイルスコープ型（C# 11.0） - ファイルスコープのアクセシビリティ
- 型エイリアス（C# 12.0） - usingエイリアスの拡張

### パターンマッチング

- 拡張されたパターンマッチング（C# 8.0/9.0/10.0） - プロパティ/タプル/位置指定パターン

### コード簡潔化

- トップレベルステートメント（C# 9.0） - プログラムエントリポイントの簡略化
- ファイルスコープ名前空間（C# 10.0） - 名前空間宣言の簡略化
- コレクション式（C# 12.0） - 統一されたコレクション初期化
- paramsコレクション（C# 13.0） - コレクション型でのparams使用

### 文字列処理

- Raw文字列リテラル（C# 11.0） - エスケープシーケンス不要の文字列

### モダンなパフォーマンス最適化

- ref structのインターフェイス実装（C# 13.0） - ref structのジェネリック制約対応

### 非同期処理

- 非同期ストリーム（C# 8.0） - IAsyncEnumerableによる非同期データシーケンス

### 型安全性

- null許容参照型（C# 8.0） - null安全性のコンパイル時保証
- パラメータnull検証（C# 11.0） - 簡潔なnullチェック

### 拡張機能

- 拡張メンバー（C# 14.0） - プロパティと静的メソッドの拡張サポート

### 関数型プログラミング

- ラムダ式強化（C# 12.0） - 式木と既定パラメータのサポート

## チェックリスト

### 必須ルール

- [ ] アンダースコアプレフィックスを使用していない
- [ ] 中括弧を省略していない（1行でも必ず使用）
- [ ] コメントは単独の行に記述している
- [ ] コメントの前に空行を入れている

### 基本ルール

- [ ] ファイルスコープ名前空間を使用している
- [ ] 言語キーワード（string, int）を使用している
- [ ] Collection Expressionsを使用している
- [ ] Raw String Literalsを使用している（該当する場合）
- [ ] パブリックメンバーにXMLドキュメントを記述している
- [ ] 最新のC#機能を活用している
